# Experimental!
PG â†š âŒ…(get|â— get|âˆ§insertâŠ™:)

M! â†^ $"map _ _"âŠ“repr($"âŠ“{_}" /$"_|_") âšÂ°$"_ â†’ _"

# A component type inside the ECS
# Maybe remove middle layer (map->data)? ï€Œ
# â”Œâ”€â•´Component
#   ~ {Map â† map[][]|Data â† []}
# 
#   # component ? entity data component
#   Add â† âœâŠ™Map(insertâŠ™âŠ¸â§») âŠ™âœâŠ™Data(ËœâŠ‚Â¤)
# 
#   # component ? entity component
#   Remove â† (
#     âœâŠ™Map(âŠ™âœâˆ©Â°mapâŠ™ğ„-âŸœâŠ¸>âŠƒget remove)
#     âœâŠ™Dataâœâ†»â†˜â‚
#   )
# 
#   # idx ? entity component
#   Idx â†š getâŠ™Map
# 
#   # data ? entity component
#   Get â† SetCdxâ‹…Data
# 
#   # component ? new entity component
#   Set â† âœâŠ™âŠ™DataâœâŠ™âŠâŠ™â—Œ SetCdx
# â””â”€â•´

â”Œâ”€â•´ECS
  ~ {Components â† map{}{}|IDCounter â† 0|IDPool â† []}

  # A component is just a map from entity id to data
  Component â†š map[][]

  # ecs ? name component ecs
  SetC â† âœâŠ™âŠ™Components insert

  # component ? name ecs
  GetC â† Â°â–¡getâŠ™Components

  # ecs ? name ecs
  NewC â† SetC âˆ©â–¡âŠ™Component

  # ecs ? name ecs
  RemoveC â† âœâŠ™Components remove

  # id ecs ? ecs
  GetNextID â† :âœâŠƒIDPool IDCounterâ£(â¤šâ‹…âŠ™âˆ˜Â°âŠ‚|âŠ™âŠ¸+â‚)

  # entities ? component(s) ecs
  Filter â† â¨¬(âŠ“/â—‡(â–½âŠ¸âˆŠ)â—Œ âšÂ°map|âŠ“â—‡âˆ˜â—Œâ—‡Â°map)â‰[]âŠ¸â–³ getâŠ™Components

  # ecs ? entities component ecs
  RemoveD â† âœâŠ™âŠ™ComponentsâœâŠ™get remove

  â€¼ â† âŒ…(^0|^0|^1)
  # TODO: underable get
  #       nicer single component/entity shape
  # data ? entities components ecs
  GetD â† (
    âŠ™âŒ…(â¥â–¡â‚=â‚âŠ¸type)
    âšPGÂ¤âŠ™GetC
    â€¼(â¥Â°â–¡â‚=â‚âŠ¸â§»|â¥Â¤â‰[]âŠ¸â–³)
  )

  # data ? components ecs
  FilterD â† GetDâ—¡Filter

  # TODO: accept tables of data, entities & components
  # table shape and entities x components must match
  # ecs ? data entities component ecs
  SetD â† âœâŠ™âŠ™âŠ™ComponentsâœâŠ™âŠ™getÂ°â—‡Â°â—‡âˆ§insert:

  # Data â† âŒ…(GetD|â— GetD|âˆ§SetD ?â‰¡â–¡â‰)

  # ecs ? id component->data ecs
  AddE â† âœâŠ™âŠ™Components(âœâŠ™âŠ™PGâšinsertâŠ™Â°Ëœmap)

  NewE â† AddE : âŠ™GetNextID

  # ecs ? entity ecs
  RemoveE â† âœâŠ™IDPoolâŠ‚âŸœâœâŠ™Componentsâšâ£removeâ—Œ
â””â”€â•´
